- name: Remove Entry If Exists
  lineinfile:
    path: /etc/hosts
    regexp: '^.*{{ hostname }}$'
    state: absent

- name: Update /etc/hosts file
  lineinfile:
    path: /etc/hosts
    line: "{{ ip_address }} {{ hostname }}"
    create: yes
    state: "{{ 'present' if remove == false else 'absent' }}"
